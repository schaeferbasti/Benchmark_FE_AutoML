#!/bin/bash

# Define the partition on which the job shall run.
#SBATCH --partition xxx

# Define a name for your job
#SBATCH --job-name FE_Pipeline

# Define the files to write the outputs of the job to.
#SBATCH --output logs/%x-%A_%a.out
#SBATCH --error logs/%x-%A_%a.err

# Define the amount of memory required per node
#SBATCH --mem 32GB
#SBATCH --cpus-per-task=8
#SBATCH --gres=localtmp:100

#SBATCH --propagate=NONE

# Define job array
#SBATCH --array=0-1351  # Adjust based on the number of methods

echo "Workingdir: $PWD"
echo "Started at $(date)"

# SLURM variables
echo "Running job $SLURM_JOB_NAME using $SLURM_JOB_CPUS_PER_NODE cpus per node with given JID $SLURM_JOB_ID on queue $SLURM_JOB_PARTITION"

# Activate your environment
# shellcheck disable=SC1090
source ~/miniconda3/bin/activate
conda activate amltk_env
echo "conda amltk_env activated"

# Install requirements
python3 -m pip install --upgrade pip
pip install -r ../../requirements.txt
echo "Requirements installed"
# shellcheck disable=SC1068

# Set the PYTHONPATH to include the src directory
export PYTHONPATH=$PWD/src:$PYTHONPATH
echo "PYTHONPATH set to $PYTHONPATH"

# Define methods and datasets array
methods_datasets=(autofeat359944 autofeat359929 autofeat233212 autofeat359937 autofeat359950 autofeat359938 autofeat233213 autofeat359942 autofeat233211 autofeat359936 autofeat359952 autofeat359951 autofeat359949 autofeat233215 autofeat360945 autofeat167210 autofeat359943 autofeat359941 autofeat359946 autofeat360933 autofeat360932 autofeat359930 autofeat233214 autofeat359948 autofeat359931 autofeat359932 autofeat359933 autofeat359934 autofeat359939 autofeat359945 autofeat359935 autofeat317614 autofeat359940 autofeat190411 autofeat359983 autofeat189354 autofeat189356 autofeat10090 autofeat359979 autofeat168868 autofeat190412 autofeat146818 autofeat359982 autofeat359967 autofeat359955 autofeat359960 autofeat359973 autofeat359968 autofeat359992 autofeat359959 autofeat359957 autofeat359977 autofeat7593 autofeat168757 autofeat211986 autofeat168909 autofeat189355 autofeat359964 autofeat359954 autofeat168910 autofeat359976 autofeat359969 autofeat359970 autofeat189922 autofeat359988 autofeat359984 autofeat360114 autofeat359966 autofeat211979 autofeat168911 autofeat359981 autofeat359962 autofeat360975 autofeat3945 autofeat360112 autofeat359991 autofeat359965 autofeat190392 autofeat359961 autofeat359953 autofeat359990 autofeat359980 autofeat167120 autofeat359993 autofeat190137 autofeat359958 autofeat190410 autofeat359971 autofeat168350 autofeat360113 autofeat359956 autofeat359989 autofeat359986 autofeat359975 autofeat359963 autofeat359994 autofeat359987 autofeat168784 autofeat359972 autofeat190146 autofeat359985 autofeat146820 autofeat359974 autofeat2073 autogluon359944 autogluon359929 autogluon233212 autogluon359937 autogluon359950 autogluon359938 autogluon233213 autogluon359942 autogluon233211 autogluon359936 autogluon359952 autogluon359951 autogluon359949 autogluon233215 autogluon360945 autogluon167210 autogluon359943 autogluon359941 autogluon359946 autogluon360933 autogluon360932 autogluon359930 autogluon233214 autogluon359948 autogluon359931 autogluon359932 autogluon359933 autogluon359934 autogluon359939 autogluon359945 autogluon359935 autogluon317614 autogluon359940 autogluon190411 autogluon359983 autogluon189354 autogluon189356 autogluon10090 autogluon359979 autogluon168868 autogluon190412 autogluon146818 autogluon359982 autogluon359967 autogluon359955 autogluon359960 autogluon359973 autogluon359968 autogluon359992 autogluon359959 autogluon359957 autogluon359977 autogluon7593 autogluon168757 autogluon211986 autogluon168909 autogluon189355 autogluon359964 autogluon359954 autogluon168910 autogluon359976 autogluon359969 autogluon359970 autogluon189922 autogluon359988 autogluon359984 autogluon360114 autogluon359966 autogluon211979 autogluon168911 autogluon359981 autogluon359962 autogluon360975 autogluon3945 autogluon360112 autogluon359991 autogluon359965 autogluon190392 autogluon359961 autogluon359953 autogluon359990 autogluon359980 autogluon167120 autogluon359993 autogluon190137 autogluon359958 autogluon190410 autogluon359971 autogluon168350 autogluon360113 autogluon359956 autogluon359989 autogluon359986 autogluon359975 autogluon359963 autogluon359994 autogluon359987 autogluon168784 autogluon359972 autogluon190146 autogluon359985 autogluon146820 autogluon359974 autogluon2073 bioautoml359944 bioautoml359929 bioautoml233212 bioautoml359937 bioautoml359950 bioautoml359938 bioautoml233213 bioautoml359942 bioautoml233211 bioautoml359936 bioautoml359952 bioautoml359951 bioautoml359949 bioautoml233215 bioautoml360945 bioautoml167210 bioautoml359943 bioautoml359941 bioautoml359946 bioautoml360933 bioautoml360932 bioautoml359930 bioautoml233214 bioautoml359948 bioautoml359931 bioautoml359932 bioautoml359933 bioautoml359934 bioautoml359939 bioautoml359945 bioautoml359935 bioautoml317614 bioautoml359940 bioautoml190411 bioautoml359983 bioautoml189354 bioautoml189356 bioautoml10090 bioautoml359979 bioautoml168868 bioautoml190412 bioautoml146818 bioautoml359982 bioautoml359967 bioautoml359955 bioautoml359960 bioautoml359973 bioautoml359968 bioautoml359992 bioautoml359959 bioautoml359957 bioautoml359977 bioautoml7593 bioautoml168757 bioautoml211986 bioautoml168909 bioautoml189355 bioautoml359964 bioautoml359954 bioautoml168910 bioautoml359976 bioautoml359969 bioautoml359970 bioautoml189922 bioautoml359988 bioautoml359984 bioautoml360114 bioautoml359966 bioautoml211979 bioautoml168911 bioautoml359981 bioautoml359962 bioautoml360975 bioautoml3945 bioautoml360112 bioautoml359991 bioautoml359965 bioautoml190392 bioautoml359961 bioautoml359953 bioautoml359990 bioautoml359980 bioautoml167120 bioautoml359993 bioautoml190137 bioautoml359958 bioautoml190410 bioautoml359971 bioautoml168350 bioautoml360113 bioautoml359956 bioautoml359989 bioautoml359986 bioautoml359975 bioautoml359963 bioautoml359994 bioautoml359987 bioautoml168784 bioautoml359972 bioautoml190146 bioautoml359985 bioautoml146820 bioautoml359974 bioautoml2073 boruta359944 boruta359929 boruta233212 boruta359937 boruta359950 boruta359938 boruta233213 boruta359942 boruta233211 boruta359936 boruta359952 boruta359951 boruta359949 boruta233215 boruta360945 boruta167210 boruta359943 boruta359941 boruta359946 boruta360933 boruta360932 boruta359930 boruta233214 boruta359948 boruta359931 boruta359932 boruta359933 boruta359934 boruta359939 boruta359945 boruta359935 boruta317614 boruta359940 boruta190411 boruta359983 boruta189354 boruta189356 boruta10090 boruta359979 boruta168868 boruta190412 boruta146818 boruta359982 boruta359967 boruta359955 boruta359960 boruta359973 boruta359968 boruta359992 boruta359959 boruta359957 boruta359977 boruta7593 boruta168757 boruta211986 boruta168909 boruta189355 boruta359964 boruta359954 boruta168910 boruta359976 boruta359969 boruta359970 boruta189922 boruta359988 boruta359984 boruta360114 boruta359966 boruta211979 boruta168911 boruta359981 boruta359962 boruta360975 boruta3945 boruta360112 boruta359991 boruta359965 boruta190392 boruta359961 boruta359953 boruta359990 boruta359980 boruta167120 boruta359993 boruta190137 boruta359958 boruta190410 boruta359971 boruta168350 boruta360113 boruta359956 boruta359989 boruta359986 boruta359975 boruta359963 boruta359994 boruta359987 boruta168784 boruta359972 boruta190146 boruta359985 boruta146820 boruta359974 boruta2073 correlationbased359944 correlationbased359929 correlationbased233212 correlationbased359937 correlationbased359950 correlationbased359938 correlationbased233213 correlationbased359942 correlationbased233211 correlationbased359936 correlationbased359952 correlationbased359951 correlationbased359949 correlationbased233215 correlationbased360945 correlationbased167210 correlationbased359943 correlationbased359941 correlationbased359946 correlationbased360933 correlationbased360932 correlationbased359930 correlationbased233214 correlationbased359948 correlationbased359931 correlationbased359932 correlationbased359933 correlationbased359934 correlationbased359939 correlationbased359945 correlationbased359935 correlationbased317614 correlationbased359940 correlationbased190411 correlationbased359983 correlationbased189354 correlationbased189356 correlationbased10090 correlationbased359979 correlationbased168868 correlationbased190412 correlationbased146818 correlationbased359982 correlationbased359967 correlationbased359955 correlationbased359960 correlationbased359973 correlationbased359968 correlationbased359992 correlationbased359959 correlationbased359957 correlationbased359977 correlationbased7593 correlationbased168757 correlationbased211986 correlationbased168909 correlationbased189355 correlationbased359964 correlationbased359954 correlationbased168910 correlationbased359976 correlationbased359969 correlationbased359970 correlationbased189922 correlationbased359988 correlationbased359984 correlationbased360114 correlationbased359966 correlationbased211979 correlationbased168911 correlationbased359981 correlationbased359962 correlationbased360975 correlationbased3945 correlationbased360112 correlationbased359991 correlationbased359965 correlationbased190392 correlationbased359961 correlationbased359953 correlationbased359990 correlationbased359980 correlationbased167120 correlationbased359993 correlationbased190137 correlationbased359958 correlationbased190410 correlationbased359971 correlationbased168350 correlationbased360113 correlationbased359956 correlationbased359989 correlationbased359986 correlationbased359975 correlationbased359963 correlationbased359994 correlationbased359987 correlationbased168784 correlationbased359972 correlationbased190146 correlationbased359985 correlationbased146820 correlationbased359974 correlationbased2073 featuretools359944 featuretools359929 featuretools233212 featuretools359937 featuretools359950 featuretools359938 featuretools233213 featuretools359942 featuretools233211 featuretools359936 featuretools359952 featuretools359951 featuretools359949 featuretools233215 featuretools360945 featuretools167210 featuretools359943 featuretools359941 featuretools359946 featuretools360933 featuretools360932 featuretools359930 featuretools233214 featuretools359948 featuretools359931 featuretools359932 featuretools359933 featuretools359934 featuretools359939 featuretools359945 featuretools359935 featuretools317614 featuretools359940 featuretools190411 featuretools359983 featuretools189354 featuretools189356 featuretools10090 featuretools359979 featuretools168868 featuretools190412 featuretools146818 featuretools359982 featuretools359967 featuretools359955 featuretools359960 featuretools359973 featuretools359968 featuretools359992 featuretools359959 featuretools359957 featuretools359977 featuretools7593 featuretools168757 featuretools211986 featuretools168909 featuretools189355 featuretools359964 featuretools359954 featuretools168910 featuretools359976 featuretools359969 featuretools359970 featuretools189922 featuretools359988 featuretools359984 featuretools360114 featuretools359966 featuretools211979 featuretools168911 featuretools359981 featuretools359962 featuretools360975 featuretools3945 featuretools360112 featuretools359991 featuretools359965 featuretools190392 featuretools359961 featuretools359953 featuretools359990 featuretools359980 featuretools167120 featuretools359993 featuretools190137 featuretools359958 featuretools190410 featuretools359971 featuretools168350 featuretools360113 featuretools359956 featuretools359989 featuretools359986 featuretools359975 featuretools359963 featuretools359994 featuretools359987 featuretools168784 featuretools359972 featuretools190146 featuretools359985 featuretools146820 featuretools359974 featuretools2073 featurewiz359944 featurewiz359929 featurewiz233212 featurewiz359937 featurewiz359950 featurewiz359938 featurewiz233213 featurewiz359942 featurewiz233211 featurewiz359936 featurewiz359952 featurewiz359951 featurewiz359949 featurewiz233215 featurewiz360945 featurewiz167210 featurewiz359943 featurewiz359941 featurewiz359946 featurewiz360933 featurewiz360932 featurewiz359930 featurewiz233214 featurewiz359948 featurewiz359931 featurewiz359932 featurewiz359933 featurewiz359934 featurewiz359939 featurewiz359945 featurewiz359935 featurewiz317614 featurewiz359940 featurewiz190411 featurewiz359983 featurewiz189354 featurewiz189356 featurewiz10090 featurewiz359979 featurewiz168868 featurewiz190412 featurewiz146818 featurewiz359982 featurewiz359967 featurewiz359955 featurewiz359960 featurewiz359973 featurewiz359968 featurewiz359992 featurewiz359959 featurewiz359957 featurewiz359977 featurewiz7593 featurewiz168757 featurewiz211986 featurewiz168909 featurewiz189355 featurewiz359964 featurewiz359954 featurewiz168910 featurewiz359976 featurewiz359969 featurewiz359970 featurewiz189922 featurewiz359988 featurewiz359984 featurewiz360114 featurewiz359966 featurewiz211979 featurewiz168911 featurewiz359981 featurewiz359962 featurewiz360975 featurewiz3945 featurewiz360112 featurewiz359991 featurewiz359965 featurewiz190392 featurewiz359961 featurewiz359953 featurewiz359990 featurewiz359980 featurewiz167120 featurewiz359993 featurewiz190137 featurewiz359958 featurewiz190410 featurewiz359971 featurewiz168350 featurewiz360113 featurewiz359956 featurewiz359989 featurewiz359986 featurewiz359975 featurewiz359963 featurewiz359994 featurewiz359987 featurewiz168784 featurewiz359972 featurewiz190146 featurewiz359985 featurewiz146820 featurewiz359974 featurewiz2073 h2o359944 h2o359929 h2o233212 h2o359937 h2o359950 h2o359938 h2o233213 h2o359942 h2o233211 h2o359936 h2o359952 h2o359951 h2o359949 h2o233215 h2o360945 h2o167210 h2o359943 h2o359941 h2o359946 h2o360933 h2o360932 h2o359930 h2o233214 h2o359948 h2o359931 h2o359932 h2o359933 h2o359934 h2o359939 h2o359945 h2o359935 h2o317614 h2o359940 h2o190411 h2o359983 h2o189354 h2o189356 h2o10090 h2o359979 h2o168868 h2o190412 h2o146818 h2o359982 h2o359967 h2o359955 h2o359960 h2o359973 h2o359968 h2o359992 h2o359959 h2o359957 h2o359977 h2o7593 h2o168757 h2o211986 h2o168909 h2o189355 h2o359964 h2o359954 h2o168910 h2o359976 h2o359969 h2o359970 h2o189922 h2o359988 h2o359984 h2o360114 h2o359966 h2o211979 h2o168911 h2o359981 h2o359962 h2o360975 h2o3945 h2o360112 h2o359991 h2o359965 h2o190392 h2o359961 h2o359953 h2o359990 h2o359980 h2o167120 h2o359993 h2o190137 h2o359958 h2o190410 h2o359971 h2o168350 h2o360113 h2o359956 h2o359989 h2o359986 h2o359975 h2o359963 h2o359994 h2o359987 h2o168784 h2o359972 h2o190146 h2o359985 h2o146820 h2o359974 h2o2073 macfe359944 macfe359929 macfe233212 macfe359937 macfe359950 macfe359938 macfe233213 macfe359942 macfe233211 macfe359936 macfe359952 macfe359951 macfe359949 macfe233215 macfe360945 macfe167210 macfe359943 macfe359941 macfe359946 macfe360933 macfe360932 macfe359930 macfe233214 macfe359948 macfe359931 macfe359932 macfe359933 macfe359934 macfe359939 macfe359945 macfe359935 macfe317614 macfe359940 macfe190411 macfe359983 macfe189354 macfe189356 macfe10090 macfe359979 macfe168868 macfe190412 macfe146818 macfe359982 macfe359967 macfe359955 macfe359960 macfe359973 macfe359968 macfe359992 macfe359959 macfe359957 macfe359977 macfe7593 macfe168757 macfe211986 macfe168909 macfe189355 macfe359964 macfe359954 macfe168910 macfe359976 macfe359969 macfe359970 macfe189922 macfe359988 macfe359984 macfe360114 macfe359966 macfe211979 macfe168911 macfe359981 macfe359962 macfe360975 macfe3945 macfe360112 macfe359991 macfe359965 macfe190392 macfe359961 macfe359953 macfe359990 macfe359980 macfe167120 macfe359993 macfe190137 macfe359958 macfe190410 macfe359971 macfe168350 macfe360113 macfe359956 macfe359989 macfe359986 macfe359975 macfe359963 macfe359994 macfe359987 macfe168784 macfe359972 macfe190146 macfe359985 macfe146820 macfe359974 macfe2073 mafese359944 mafese359929 mafese233212 mafese359937 mafese359950 mafese359938 mafese233213 mafese359942 mafese233211 mafese359936 mafese359952 mafese359951 mafese359949 mafese233215 mafese360945 mafese167210 mafese359943 mafese359941 mafese359946 mafese360933 mafese360932 mafese359930 mafese233214 mafese359948 mafese359931 mafese359932 mafese359933 mafese359934 mafese359939 mafese359945 mafese359935 mafese317614 mafese359940 mafese190411 mafese359983 mafese189354 mafese189356 mafese10090 mafese359979 mafese168868 mafese190412 mafese146818 mafese359982 mafese359967 mafese359955 mafese359960 mafese359973 mafese359968 mafese359992 mafese359959 mafese359957 mafese359977 mafese7593 mafese168757 mafese211986 mafese168909 mafese189355 mafese359964 mafese359954 mafese168910 mafese359976 mafese359969 mafese359970 mafese189922 mafese359988 mafese359984 mafese360114 mafese359966 mafese211979 mafese168911 mafese359981 mafese359962 mafese360975 mafese3945 mafese360112 mafese359991 mafese359965 mafese190392 mafese359961 mafese359953 mafese359990 mafese359980 mafese167120 mafese359993 mafese190137 mafese359958 mafese190410 mafese359971 mafese168350 mafese360113 mafese359956 mafese359989 mafese359986 mafese359975 mafese359963 mafese359994 mafese359987 mafese168784 mafese359972 mafese190146 mafese359985 mafese146820 mafese359974 mafese2073 mljar359944 mljar359929 mljar233212 mljar359937 mljar359950 mljar359938 mljar233213 mljar359942 mljar233211 mljar359936 mljar359952 mljar359951 mljar359949 mljar233215 mljar360945 mljar167210 mljar359943 mljar359941 mljar359946 mljar360933 mljar360932 mljar359930 mljar233214 mljar359948 mljar359931 mljar359932 mljar359933 mljar359934 mljar359939 mljar359945 mljar359935 mljar317614 mljar359940 mljar190411 mljar359983 mljar189354 mljar189356 mljar10090 mljar359979 mljar168868 mljar190412 mljar146818 mljar359982 mljar359967 mljar359955 mljar359960 mljar359973 mljar359968 mljar359992 mljar359959 mljar359957 mljar359977 mljar7593 mljar168757 mljar211986 mljar168909 mljar189355 mljar359964 mljar359954 mljar168910 mljar359976 mljar359969 mljar359970 mljar189922 mljar359988 mljar359984 mljar360114 mljar359966 mljar211979 mljar168911 mljar359981 mljar359962 mljar360975 mljar3945 mljar360112 mljar359991 mljar359965 mljar190392 mljar359961 mljar359953 mljar359990 mljar359980 mljar167120 mljar359993 mljar190137 mljar359958 mljar190410 mljar359971 mljar168350 mljar360113 mljar359956 mljar359989 mljar359986 mljar359975 mljar359963 mljar359994 mljar359987 mljar168784 mljar359972 mljar190146 mljar359985 mljar146820 mljar359974 mljar2073 nfs359944 nfs359929 nfs233212 nfs359937 nfs359950 nfs359938 nfs233213 nfs359942 nfs233211 nfs359936 nfs359952 nfs359951 nfs359949 nfs233215 nfs360945 nfs167210 nfs359943 nfs359941 nfs359946 nfs360933 nfs360932 nfs359930 nfs233214 nfs359948 nfs359931 nfs359932 nfs359933 nfs359934 nfs359939 nfs359945 nfs359935 nfs317614 nfs359940 nfs190411 nfs359983 nfs189354 nfs189356 nfs10090 nfs359979 nfs168868 nfs190412 nfs146818 nfs359982 nfs359967 nfs359955 nfs359960 nfs359973 nfs359968 nfs359992 nfs359959 nfs359957 nfs359977 nfs7593 nfs168757 nfs211986 nfs168909 nfs189355 nfs359964 nfs359954 nfs168910 nfs359976 nfs359969 nfs359970 nfs189922 nfs359988 nfs359984 nfs360114 nfs359966 nfs211979 nfs168911 nfs359981 nfs359962 nfs360975 nfs3945 nfs360112 nfs359991 nfs359965 nfs190392 nfs359961 nfs359953 nfs359990 nfs359980 nfs167120 nfs359993 nfs190137 nfs359958 nfs190410 nfs359971 nfs168350 nfs360113 nfs359956 nfs359989 nfs359986 nfs359975 nfs359963 nfs359994 nfs359987 nfs168784 nfs359972 nfs190146 nfs359985 nfs146820 nfs359974 nfs2073 openfe359944 openfe359929 openfe233212 openfe359937 openfe359950 openfe359938 openfe233213 openfe359942 openfe233211 openfe359936 openfe359952 openfe359951 openfe359949 openfe233215 openfe360945 openfe167210 openfe359943 openfe359941 openfe359946 openfe360933 openfe360932 openfe359930 openfe233214 openfe359948 openfe359931 openfe359932 openfe359933 openfe359934 openfe359939 openfe359945 openfe359935 openfe317614 openfe359940 openfe190411 openfe359983 openfe189354 openfe189356 openfe10090 openfe359979 openfe168868 openfe190412 openfe146818 openfe359982 openfe359967 openfe359955 openfe359960 openfe359973 openfe359968 openfe359992 openfe359959 openfe359957 openfe359977 openfe7593 openfe168757 openfe211986 openfe168909 openfe189355 openfe359964 openfe359954 openfe168910 openfe359976 openfe359969 openfe359970 openfe189922 openfe359988 openfe359984 openfe360114 openfe359966 openfe211979 openfe168911 openfe359981 openfe359962 openfe360975 openfe3945 openfe360112 openfe359991 openfe359965 openfe190392 openfe359961 openfe359953 openfe359990 openfe359980 openfe167120 openfe359993 openfe190137 openfe359958 openfe190410 openfe359971 openfe168350 openfe360113 openfe359956 openfe359989 openfe359986 openfe359975 openfe359963 openfe359994 openfe359987 openfe168784 openfe359972 openfe190146 openfe359985 openfe146820 openfe359974 openfe2073)

# Get the method name based on SLURM_ARRAY_TASK_ID
method_dataset=${methods_datasets[$SLURM_ARRAY_TASK_ID]}

# Run the job with the specified method
# shellcheck disable=SC2006
start=`date +%s`

echo "Running Method: $method_dataset"
python3 src/feature_engineering/run_feature_engineering_parallel.py --method_dataset "$method_dataset"

# shellcheck disable=SC2006
end=`date +%s`
runtime=$((end-start))

echo "Job execution complete."
echo "Runtime: $runtime"